<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Service Worker Reset</title>
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; padding: 2rem; max-width: 600px; margin: 0 auto; line-height: 1.5; }
        .status { padding: 1rem; border-radius: 8px; margin-top: 1rem; }
        .success { background-color: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
        .info { background-color: #e0f2fe; color: #075985; border: 1px solid #bae6fd; }
    </style>
</head>
<body>
    <h1>Service Worker Reset Tool</h1>
    <p>This page will forcefully unregister all Service Workers for this origin.</p>
    <div id="status" class="status info">Scanning...</div>

    <script>
        const statusEl = document.getElementById('status');
        
        async function reset() {
            if (!('serviceWorker' in navigator)) {
                statusEl.textContent = "Service Workers not supported in this browser.";
                return;
            }

            try {
                const registrations = await navigator.serviceWorker.getRegistrations();
                if (registrations.length === 0) {
                    statusEl.textContent = "✅ No active Service Workers found. You are clean.";
                    statusEl.className = "status success";
                    return;
                }

                let count = 0;
                for (const registration of registrations) {
                    const success = await registration.unregister();
                    if (success) {
                        console.log('Unregistered SW:', registration);
                        count++;
                    }
                }

                if (count > 0) {
                    statusEl.innerHTML = `✅ Successfully unregistered <strong>${count}</strong> Service Worker(s).<br>Please close all tabs of this site and reopen.`;
                    statusEl.className = "status success";
                } else {
                    statusEl.textContent = "Found Service Workers but failed to unregister them. Try manually in DevTools > Application.";
                }

            } catch (e) {
                statusEl.textContent = "Error: " + e.message;
                console.error(e);
            }
        }

        reset();
    </script>
</body>
</html>
